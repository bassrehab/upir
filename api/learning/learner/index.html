
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Universal Plan Intermediate Representation - Formal verification, synthesis, and optimization for distributed systems">
      
      
        <meta name="author" content="Subhadip Mitra">
      
      
        <link rel="canonical" href="https://upir.subhadipmitra.com/api/learning/learner/">
      
      
        <link rel="prev" href="../../synthesis/sketch/">
      
      
        <link rel="next" href="../ppo/">
      
      
        
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>RL Optimizer - UPIR Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.618322db.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="amber" data-md-color-accent="amber">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#rl-optimizer" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="UPIR Documentation" class="md-header__button md-logo" aria-label="UPIR Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            UPIR Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              RL Optimizer
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="amber" data-md-color-accent="amber"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="amber" data-md-color-accent="amber"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/bassrehab/upir" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    bassrehab/upir
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../getting-started/installation/" class="md-tabs__link">
          
  
  
  Getting Started

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../guide/specifications/" class="md-tabs__link">
          
  
  
  User Guide

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../core/upir/" class="md-tabs__link">
          
  
  
  API Reference

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../examples/streaming/" class="md-tabs__link">
          
  
  
  Examples

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../contributing/setup/" class="md-tabs__link">
          
  
  
  Contributing

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../about/attribution/" class="md-tabs__link">
          
  
  
  About

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="UPIR Documentation" class="md-nav__button md-logo" aria-label="UPIR Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    UPIR Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/bassrehab/upir" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    bassrehab/upir
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Getting Started
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Getting Started
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../getting-started/installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Installation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../getting-started/quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quick Start
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../getting-started/concepts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Core Concepts
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    User Guide
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    User Guide
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guide/specifications/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Formal Specifications
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guide/verification/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Verification
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guide/synthesis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Synthesis
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guide/learning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Learning & Optimization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guide/patterns/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Pattern Library
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    API Reference
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    API Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_1" >
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Core
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Core
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../core/upir/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    UPIR
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../core/architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../core/specification/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Specification
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../core/temporal/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Temporal Logic
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../core/evidence/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Evidence
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Verification
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Verification
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../verification/verifier/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Verifier
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../verification/solver/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SMT Solver
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_3" >
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Synthesis
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Synthesis
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../synthesis/cegis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CEGIS
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../synthesis/sketch/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Sketch
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Learning
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Learning
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    RL Optimizer
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    RL Optimizer
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        Overview
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#class-documentation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Class Documentation
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#upir.learning.learner.ArchitectureLearner" class="md-nav__link">
    <span class="md-ellipsis">
      
        ArchitectureLearner
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ArchitectureLearner">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#upir.learning.learner.ArchitectureLearner--after-deploying-architecture-and-collecting-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      
        After deploying architecture and collecting metrics:
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#upir.learning.learner.ArchitectureLearner-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#upir.learning.learner.ArchitectureLearner.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#upir.learning.learner.ArchitectureLearner.encode_state" class="md-nav__link">
    <span class="md-ellipsis">
      
        encode_state
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#upir.learning.learner.ArchitectureLearner.decode_action" class="md-nav__link">
    <span class="md-ellipsis">
      
        decode_action
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#upir.learning.learner.ArchitectureLearner.compute_reward" class="md-nav__link">
    <span class="md-ellipsis">
      
        compute_reward
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#upir.learning.learner.ArchitectureLearner.learn_from_metrics" class="md-nav__link">
    <span class="md-ellipsis">
      
        learn_from_metrics
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#upir.learning.learner.ArchitectureLearner.__str__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __str__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#upir.learning.learner.ArchitectureLearner.__repr__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __repr__
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage-example" class="md-nav__link">
    <span class="md-ellipsis">
      
        Usage Example
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#see-also" class="md-nav__link">
    <span class="md-ellipsis">
      
        See Also
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ppo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    PPO
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_5" >
        
          
          <label class="md-nav__link" for="__nav_4_5" id="__nav_4_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Patterns
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Patterns
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/pattern/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Pattern
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/extractor/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Pattern Extractor
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/library/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Pattern Library
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Examples
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Examples
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/streaming/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Streaming Pipeline
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/batch/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Batch Processing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/patterns/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Custom Patterns
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Contributing
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Contributing
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../contributing/setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Development Setup
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../contributing/style/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Code Style
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../contributing/testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Testing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    About
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    About
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../about/attribution/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Attribution
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../about/license/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    License
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../about/references/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    References
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        Overview
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#class-documentation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Class Documentation
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#upir.learning.learner.ArchitectureLearner" class="md-nav__link">
    <span class="md-ellipsis">
      
        ArchitectureLearner
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ArchitectureLearner">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#upir.learning.learner.ArchitectureLearner--after-deploying-architecture-and-collecting-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      
        After deploying architecture and collecting metrics:
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#upir.learning.learner.ArchitectureLearner-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#upir.learning.learner.ArchitectureLearner.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#upir.learning.learner.ArchitectureLearner.encode_state" class="md-nav__link">
    <span class="md-ellipsis">
      
        encode_state
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#upir.learning.learner.ArchitectureLearner.decode_action" class="md-nav__link">
    <span class="md-ellipsis">
      
        decode_action
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#upir.learning.learner.ArchitectureLearner.compute_reward" class="md-nav__link">
    <span class="md-ellipsis">
      
        compute_reward
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#upir.learning.learner.ArchitectureLearner.learn_from_metrics" class="md-nav__link">
    <span class="md-ellipsis">
      
        learn_from_metrics
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#upir.learning.learner.ArchitectureLearner.__str__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __str__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#upir.learning.learner.ArchitectureLearner.__repr__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __repr__
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage-example" class="md-nav__link">
    <span class="md-ellipsis">
      
        Usage Example
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#see-also" class="md-nav__link">
    <span class="md-ellipsis">
      
        See Also
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="rl-optimizer">RL Optimizer<a class="headerlink" href="#rl-optimizer" title="Permanent link">&para;</a></h1>
<p>Reinforcement learning-based architecture optimization.</p>
<hr />
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h2>
<p>The <code>ArchitectureLearner</code> uses PPO (Proximal Policy Optimization) to optimize architectures from production metrics.</p>
<hr />
<h2 id="class-documentation">Class Documentation<a class="headerlink" href="#class-documentation" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-class">



<h2 id="upir.learning.learner.ArchitectureLearner" class="doc doc-heading">
            <code>upir.learning.learner.ArchitectureLearner</code>


<a href="#upir.learning.learner.ArchitectureLearner" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents first">



        <p>Learn optimal architectures using PPO reinforcement learning.</p>
<p>The learner encodes UPIR architectures as state vectors, uses PPO to
select architectural modifications (actions), and learns from performance
metrics (rewards) to optimize the architecture over time.</p>
<p>State encoding extracts features like component count, latency, throughput.
Actions represent architectural changes (adjust parallelism, change types, etc.).
Rewards combine constraint satisfaction and performance improvements.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="upir.learning.learner.ArchitectureLearner.state_dim">state_dim</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Fixed dimension of state vectors</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="upir.learning.learner.ArchitectureLearner.action_dim">action_dim</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of possible actions</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="upir.learning.learner.ArchitectureLearner.ppo">ppo</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>PPO agent for policy learning</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="upir.learning.learner.ArchitectureLearner.experience_buffer">experience_buffer</span></code></td>
            <td>
                  <code><span title="typing.Deque">Deque</span>[<span title="upir.learning.learner.Experience">Experience</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Replay buffer for experiences</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="upir.learning.learner.ArchitectureLearner.config">config</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>PPO configuration</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>learner = ArchitectureLearner(state_dim=64, action_dim=40)</p>
<h3 id="upir.learning.learner.ArchitectureLearner--after-deploying-architecture-and-collecting-metrics">After deploying architecture and collecting metrics:<a class="headerlink" href="#upir.learning.learner.ArchitectureLearner--after-deploying-architecture-and-collecting-metrics" title="Permanent link">&para;</a></h3>
<p>optimized_upir = learner.learn_from_metrics(upir, metrics)</p>
</blockquote>
</blockquote>
</blockquote>
</details>        <p>References:
- PPO: Policy gradient method with clipped objective
- TD Commons: Architecture optimization approach
- OpenAI Spinning Up: RL best practices</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>upir/learning/learner.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span>
<span class="normal"><a href="#__codelineno-0-499">499</a></span>
<span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span>
<span class="normal"><a href="#__codelineno-0-504">504</a></span>
<span class="normal"><a href="#__codelineno-0-505">505</a></span>
<span class="normal"><a href="#__codelineno-0-506">506</a></span>
<span class="normal"><a href="#__codelineno-0-507">507</a></span>
<span class="normal"><a href="#__codelineno-0-508">508</a></span>
<span class="normal"><a href="#__codelineno-0-509">509</a></span>
<span class="normal"><a href="#__codelineno-0-510">510</a></span>
<span class="normal"><a href="#__codelineno-0-511">511</a></span>
<span class="normal"><a href="#__codelineno-0-512">512</a></span>
<span class="normal"><a href="#__codelineno-0-513">513</a></span>
<span class="normal"><a href="#__codelineno-0-514">514</a></span>
<span class="normal"><a href="#__codelineno-0-515">515</a></span>
<span class="normal"><a href="#__codelineno-0-516">516</a></span>
<span class="normal"><a href="#__codelineno-0-517">517</a></span>
<span class="normal"><a href="#__codelineno-0-518">518</a></span>
<span class="normal"><a href="#__codelineno-0-519">519</a></span>
<span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span>
<span class="normal"><a href="#__codelineno-0-522">522</a></span>
<span class="normal"><a href="#__codelineno-0-523">523</a></span>
<span class="normal"><a href="#__codelineno-0-524">524</a></span>
<span class="normal"><a href="#__codelineno-0-525">525</a></span>
<span class="normal"><a href="#__codelineno-0-526">526</a></span>
<span class="normal"><a href="#__codelineno-0-527">527</a></span>
<span class="normal"><a href="#__codelineno-0-528">528</a></span>
<span class="normal"><a href="#__codelineno-0-529">529</a></span>
<span class="normal"><a href="#__codelineno-0-530">530</a></span>
<span class="normal"><a href="#__codelineno-0-531">531</a></span>
<span class="normal"><a href="#__codelineno-0-532">532</a></span>
<span class="normal"><a href="#__codelineno-0-533">533</a></span>
<span class="normal"><a href="#__codelineno-0-534">534</a></span>
<span class="normal"><a href="#__codelineno-0-535">535</a></span>
<span class="normal"><a href="#__codelineno-0-536">536</a></span>
<span class="normal"><a href="#__codelineno-0-537">537</a></span>
<span class="normal"><a href="#__codelineno-0-538">538</a></span>
<span class="normal"><a href="#__codelineno-0-539">539</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="k">class</span><span class="w"> </span><span class="nc">ArchitectureLearner</span><span class="p">:</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">    Learn optimal architectures using PPO reinforcement learning.</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">    The learner encodes UPIR architectures as state vectors, uses PPO to</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">    select architectural modifications (actions), and learns from performance</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">    metrics (rewards) to optimize the architecture over time.</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">    State encoding extracts features like component count, latency, throughput.</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">    Actions represent architectural changes (adjust parallelism, change types, etc.).</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">    Rewards combine constraint satisfaction and performance improvements.</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">    Attributes:</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">        state_dim: Fixed dimension of state vectors</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="sd">        action_dim: Number of possible actions</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">        ppo: PPO agent for policy learning</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">        experience_buffer: Replay buffer for experiences</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">        config: PPO configuration</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">    Example:</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">        &gt;&gt;&gt; learner = ArchitectureLearner(state_dim=64, action_dim=40)</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">        &gt;&gt;&gt; # After deploying architecture and collecting metrics:</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">        &gt;&gt;&gt; optimized_upir = learner.learn_from_metrics(upir, metrics)</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">    References:</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">    - PPO: Policy gradient method with clipped objective</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">    - TD Commons: Architecture optimization approach</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">    - OpenAI Spinning Up: RL best practices</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>        <span class="n">state_dim</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">64</span><span class="p">,</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>        <span class="n">action_dim</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">40</span><span class="p">,</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>        <span class="n">config</span><span class="p">:</span> <span class="n">PPOConfig</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>        <span class="n">buffer_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>    <span class="p">):</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="sd">        Initialize architecture learner.</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="sd">            state_dim: Dimension of state encoding (default 64)</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="sd">            action_dim: Number of possible actions (default 40)</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="sd">            config: PPO configuration (uses defaults if None)</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="sd">            buffer_size: Maximum size of experience buffer</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">state_dim</span> <span class="o">=</span> <span class="n">state_dim</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">action_dim</span> <span class="o">=</span> <span class="n">action_dim</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span> <span class="ow">or</span> <span class="n">PPOConfig</span><span class="p">()</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>        <span class="c1"># Initialize PPO agent</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ppo</span> <span class="o">=</span> <span class="n">PPO</span><span class="p">(</span><span class="n">state_dim</span><span class="o">=</span><span class="n">state_dim</span><span class="p">,</span> <span class="n">action_dim</span><span class="o">=</span><span class="n">action_dim</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">)</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>        <span class="c1"># Experience buffer for training</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">experience_buffer</span><span class="p">:</span> <span class="n">Deque</span><span class="p">[</span><span class="n">Experience</span><span class="p">]</span> <span class="o">=</span> <span class="n">deque</span><span class="p">(</span><span class="n">maxlen</span><span class="o">=</span><span class="n">buffer_size</span><span class="p">)</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>        <span class="c1"># Feature normalization stats (updated online)</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">feature_stats</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>            <span class="s2">&quot;num_components_max&quot;</span><span class="p">:</span> <span class="mf">100.0</span><span class="p">,</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>            <span class="s2">&quot;num_connections_max&quot;</span><span class="p">:</span> <span class="mf">200.0</span><span class="p">,</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>            <span class="s2">&quot;avg_latency_max&quot;</span><span class="p">:</span> <span class="mf">10000.0</span><span class="p">,</span>  <span class="c1"># 10 seconds in ms</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>            <span class="s2">&quot;total_throughput_max&quot;</span><span class="p">:</span> <span class="mf">100000.0</span><span class="p">,</span>  <span class="c1"># 100k QPS</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>            <span class="s2">&quot;complexity_max&quot;</span><span class="p">:</span> <span class="mf">1000.0</span><span class="p">,</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>        <span class="p">}</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>            <span class="sa">f</span><span class="s2">&quot;Initialized ArchitectureLearner: state_dim=</span><span class="si">{</span><span class="n">state_dim</span><span class="si">}</span><span class="s2">, &quot;</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>            <span class="sa">f</span><span class="s2">&quot;action_dim=</span><span class="si">{</span><span class="n">action_dim</span><span class="si">}</span><span class="s2">, buffer_size=</span><span class="si">{</span><span class="n">buffer_size</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>        <span class="p">)</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">encode_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">upir</span><span class="p">:</span> <span class="n">UPIR</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="sd">        Encode UPIR architecture as fixed-size state vector.</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">        Extracts architectural features and normalizes to [0, 1] range:</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="sd">        - Number of components</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="sd">        - Number of connections</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="sd">        - Average component latency</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="sd">        - Total throughput capacity</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a><span class="sd">        - Deployment complexity score</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="sd">        The state is padded to fixed size (state_dim) for consistent input.</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="sd">            upir: UPIR to encode</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a><span class="sd">            State vector (state_dim,) with values in [0, 1]</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a><span class="sd">        Example:</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a><span class="sd">            &gt;&gt;&gt; learner = ArchitectureLearner()</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a><span class="sd">            &gt;&gt;&gt; upir = UPIR(id=&quot;test&quot;, name=&quot;Test&quot;, description=&quot;Test&quot;)</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a><span class="sd">            &gt;&gt;&gt; state = learner.encode_state(upir)</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a><span class="sd">            &gt;&gt;&gt; state.shape</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a><span class="sd">            (64,)</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a><span class="sd">            &gt;&gt;&gt; assert np.all((state &gt;= 0) &amp; (state &lt;= 1))</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>        <span class="k">if</span> <span class="n">upir</span><span class="o">.</span><span class="n">architecture</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>            <span class="c1"># No architecture - return zero state</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state_dim</span><span class="p">)</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>        <span class="n">arch</span> <span class="o">=</span> <span class="n">upir</span><span class="o">.</span><span class="n">architecture</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>        <span class="c1"># Extract basic features</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>        <span class="n">num_components</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">arch</span><span class="o">.</span><span class="n">components</span><span class="p">)</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>        <span class="n">num_connections</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">arch</span><span class="o">.</span><span class="n">connections</span><span class="p">)</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>        <span class="c1"># Compute average latency (if components have latency info)</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>        <span class="n">total_latency</span> <span class="o">=</span> <span class="mf">0.0</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>        <span class="n">latency_count</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>        <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="n">arch</span><span class="o">.</span><span class="n">components</span><span class="p">:</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;latency_ms&quot;</span> <span class="ow">in</span> <span class="n">comp</span><span class="p">:</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>                <span class="n">total_latency</span> <span class="o">+=</span> <span class="n">comp</span><span class="p">[</span><span class="s2">&quot;latency_ms&quot;</span><span class="p">]</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>                <span class="n">latency_count</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>        <span class="n">avg_latency</span> <span class="o">=</span> <span class="n">total_latency</span> <span class="o">/</span> <span class="n">latency_count</span> <span class="k">if</span> <span class="n">latency_count</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mf">0.0</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>        <span class="c1"># Compute total throughput (if components have throughput info)</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>        <span class="n">total_throughput</span> <span class="o">=</span> <span class="mf">0.0</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>        <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="n">arch</span><span class="o">.</span><span class="n">components</span><span class="p">:</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;throughput_qps&quot;</span> <span class="ow">in</span> <span class="n">comp</span><span class="p">:</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>                <span class="n">total_throughput</span> <span class="o">+=</span> <span class="n">comp</span><span class="p">[</span><span class="s2">&quot;throughput_qps&quot;</span><span class="p">]</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>        <span class="c1"># Compute deployment complexity (simple heuristic)</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>        <span class="c1"># Based on number of components and connections</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>        <span class="n">complexity</span> <span class="o">=</span> <span class="n">num_components</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">+</span> <span class="n">num_connections</span> <span class="o">*</span> <span class="mi">5</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>        <span class="c1"># Normalize features to [0, 1]</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>        <span class="n">features</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>            <span class="n">num_components</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_stats</span><span class="p">[</span><span class="s2">&quot;num_components_max&quot;</span><span class="p">],</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>            <span class="n">num_connections</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_stats</span><span class="p">[</span><span class="s2">&quot;num_connections_max&quot;</span><span class="p">],</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>            <span class="n">avg_latency</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_stats</span><span class="p">[</span><span class="s2">&quot;avg_latency_max&quot;</span><span class="p">],</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>            <span class="n">total_throughput</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_stats</span><span class="p">[</span><span class="s2">&quot;total_throughput_max&quot;</span><span class="p">],</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>            <span class="n">complexity</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_stats</span><span class="p">[</span><span class="s2">&quot;complexity_max&quot;</span><span class="p">],</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>        <span class="p">])</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>        <span class="c1"># Clip to [0, 1] range</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>        <span class="n">features</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>        <span class="c1"># Add per-component features (latency, throughput, parallelism)</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>        <span class="n">component_features</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>        <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="n">arch</span><span class="o">.</span><span class="n">components</span><span class="p">[:</span><span class="mi">10</span><span class="p">]:</span>  <span class="c1"># Max 10 components</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>                <span class="n">comp_latency</span> <span class="o">=</span> <span class="n">comp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;latency_ms&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>                <span class="n">comp_throughput</span> <span class="o">=</span> <span class="n">comp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;throughput_qps&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>                <span class="n">comp_parallelism</span> <span class="o">=</span> <span class="n">comp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;parallelism&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>                <span class="n">component_features</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>                    <span class="n">comp_latency</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_stats</span><span class="p">[</span><span class="s2">&quot;avg_latency_max&quot;</span><span class="p">],</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>                    <span class="n">comp_throughput</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_stats</span><span class="p">[</span><span class="s2">&quot;total_throughput_max&quot;</span><span class="p">],</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>                    <span class="n">comp_parallelism</span> <span class="o">/</span> <span class="mf">100.0</span><span class="p">,</span>  <span class="c1"># Normalize to [0, 1] assuming max 100</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>                <span class="p">])</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>        <span class="c1"># Pad to fixed size</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>        <span class="n">all_features</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">features</span><span class="p">,</span> <span class="n">component_features</span><span class="p">])</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>        <span class="c1"># Clip all features to [0, 1] range</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>        <span class="n">all_features</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">all_features</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_features</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_dim</span><span class="p">:</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>            <span class="c1"># Pad with zeros</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>            <span class="n">all_features</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>                <span class="n">all_features</span><span class="p">,</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>                <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_dim</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_features</span><span class="p">)),</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>                <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;constant&quot;</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>            <span class="p">)</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>            <span class="c1"># Truncate if too long</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>            <span class="n">all_features</span> <span class="o">=</span> <span class="n">all_features</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">state_dim</span><span class="p">]</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>        <span class="k">return</span> <span class="n">all_features</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">decode_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">upir</span><span class="p">:</span> <span class="n">UPIR</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">UPIR</span><span class="p">:</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a><span class="sd">        Decode action and apply architectural modification.</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a><span class="sd">        Actions represent different architectural changes:</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a><span class="sd">        - 0-9: Increase parallelism of component i</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a><span class="sd">        - 10-19: Decrease parallelism of component i</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a><span class="sd">        - 20-29: Change component type (e.g., batch -&gt; streaming)</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a><span class="sd">        - 30-39: Modify connection (add/remove)</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a><span class="sd">            action: Action index (0 to action_dim-1)</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a><span class="sd">            upir: Current UPIR</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a><span class="sd">            Modified UPIR with architectural change applied</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a><span class="sd">        Example:</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a><span class="sd">            &gt;&gt;&gt; learner = ArchitectureLearner()</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a><span class="sd">            &gt;&gt;&gt; upir = UPIR(id=&quot;test&quot;, name=&quot;Test&quot;, description=&quot;Test&quot;)</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a><span class="sd">            &gt;&gt;&gt; modified = learner.decode_action(0, upir)</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>        <span class="c1"># Create copy to avoid modifying original</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>        <span class="n">modified_upir</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">upir</span><span class="p">)</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>        <span class="k">if</span> <span class="n">modified_upir</span><span class="o">.</span><span class="n">architecture</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No architecture to modify&quot;</span><span class="p">)</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>            <span class="k">return</span> <span class="n">modified_upir</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>        <span class="n">arch</span> <span class="o">=</span> <span class="n">modified_upir</span><span class="o">.</span><span class="n">architecture</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>        <span class="n">num_components</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">arch</span><span class="o">.</span><span class="n">components</span><span class="p">)</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>        <span class="k">if</span> <span class="n">num_components</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No components to modify&quot;</span><span class="p">)</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>            <span class="k">return</span> <span class="n">modified_upir</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>        <span class="c1"># Decode action type and target</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>        <span class="k">if</span> <span class="n">action</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>            <span class="c1"># Increase parallelism of component (action % num_components)</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>            <span class="n">component_idx</span> <span class="o">=</span> <span class="n">action</span> <span class="o">%</span> <span class="n">num_components</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>            <span class="n">comp</span> <span class="o">=</span> <span class="n">arch</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">component_idx</span><span class="p">]</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>            <span class="n">current_parallelism</span> <span class="o">=</span> <span class="n">comp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;parallelism&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>            <span class="n">new_parallelism</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">current_parallelism</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>            <span class="n">comp</span><span class="p">[</span><span class="s2">&quot;parallelism&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_parallelism</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>                <span class="sa">f</span><span class="s2">&quot;Action </span><span class="si">{</span><span class="n">action</span><span class="si">}</span><span class="s2">: Increase parallelism of </span><span class="si">{</span><span class="n">comp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="w"> </span><span class="sa">f</span><span class="s1">&#39;comp_</span><span class="si">{</span><span class="n">component_idx</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> &quot;</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>                <span class="sa">f</span><span class="s2">&quot;from </span><span class="si">{</span><span class="n">current_parallelism</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">new_parallelism</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>            <span class="p">)</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>        <span class="k">elif</span> <span class="n">action</span> <span class="o">&lt;</span> <span class="mi">20</span><span class="p">:</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>            <span class="c1"># Decrease parallelism of component</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>            <span class="n">component_idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">action</span> <span class="o">-</span> <span class="mi">10</span><span class="p">)</span> <span class="o">%</span> <span class="n">num_components</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>            <span class="n">comp</span> <span class="o">=</span> <span class="n">arch</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">component_idx</span><span class="p">]</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>            <span class="n">current_parallelism</span> <span class="o">=</span> <span class="n">comp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;parallelism&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>            <span class="n">new_parallelism</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">current_parallelism</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>            <span class="n">comp</span><span class="p">[</span><span class="s2">&quot;parallelism&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_parallelism</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>                <span class="sa">f</span><span class="s2">&quot;Action </span><span class="si">{</span><span class="n">action</span><span class="si">}</span><span class="s2">: Decrease parallelism of </span><span class="si">{</span><span class="n">comp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="w"> </span><span class="sa">f</span><span class="s1">&#39;comp_</span><span class="si">{</span><span class="n">component_idx</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> &quot;</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>                <span class="sa">f</span><span class="s2">&quot;from </span><span class="si">{</span><span class="n">current_parallelism</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">new_parallelism</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>            <span class="p">)</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>        <span class="k">elif</span> <span class="n">action</span> <span class="o">&lt;</span> <span class="mi">30</span><span class="p">:</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>            <span class="c1"># Change component type (simplified: toggle between batch/streaming)</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>            <span class="n">component_idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">action</span> <span class="o">-</span> <span class="mi">20</span><span class="p">)</span> <span class="o">%</span> <span class="n">num_components</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>            <span class="n">comp</span> <span class="o">=</span> <span class="n">arch</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">component_idx</span><span class="p">]</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>            <span class="n">current_type</span> <span class="o">=</span> <span class="n">comp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;processor&quot;</span><span class="p">)</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>            <span class="k">if</span> <span class="s2">&quot;streaming&quot;</span> <span class="ow">in</span> <span class="n">current_type</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>                <span class="n">new_type</span> <span class="o">=</span> <span class="s2">&quot;batch_processor&quot;</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>                <span class="n">new_type</span> <span class="o">=</span> <span class="s2">&quot;streaming_processor&quot;</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>            <span class="n">comp</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_type</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>                <span class="sa">f</span><span class="s2">&quot;Action </span><span class="si">{</span><span class="n">action</span><span class="si">}</span><span class="s2">: Change type of </span><span class="si">{</span><span class="n">comp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="w"> </span><span class="sa">f</span><span class="s1">&#39;comp_</span><span class="si">{</span><span class="n">component_idx</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> &quot;</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>                <span class="sa">f</span><span class="s2">&quot;from </span><span class="si">{</span><span class="n">current_type</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">new_type</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>            <span class="p">)</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>            <span class="c1"># Modify connection (simplified: toggle connection property)</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arch</span><span class="o">.</span><span class="n">connections</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>                <span class="n">connection_idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">action</span> <span class="o">-</span> <span class="mi">30</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">arch</span><span class="o">.</span><span class="n">connections</span><span class="p">)</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>                <span class="n">conn</span> <span class="o">=</span> <span class="n">arch</span><span class="o">.</span><span class="n">connections</span><span class="p">[</span><span class="n">connection_idx</span><span class="p">]</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>                <span class="c1"># Toggle &quot;batched&quot; property</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>                <span class="n">current_batched</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;batched&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>                <span class="n">conn</span><span class="p">[</span><span class="s2">&quot;batched&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">current_batched</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>                    <span class="sa">f</span><span class="s2">&quot;Action </span><span class="si">{</span><span class="n">action</span><span class="si">}</span><span class="s2">: Toggle batched for connection &quot;</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">conn</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;from&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;?&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">-&gt;</span><span class="si">{</span><span class="n">conn</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;to&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;?&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="ow">not</span><span class="w"> </span><span class="n">current_batched</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>                <span class="p">)</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>        <span class="k">return</span> <span class="n">modified_upir</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">compute_reward</span><span class="p">(</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>        <span class="n">metrics</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>        <span class="n">spec</span><span class="p">:</span> <span class="n">FormalSpecification</span><span class="p">,</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>        <span class="n">previous_metrics</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a><span class="sd">        Compute reward from performance metrics and specification.</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a><span class="sd">        Reward structure:</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a><span class="sd">        - Base reward: 1.0</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a><span class="sd">        - Constraint satisfaction: +0.1 per met constraint, -0.5 per violation</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a><span class="sd">        - Performance improvement: +delta/target for improvements</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a><span class="sd">        Rewards are clipped to [-1, 1] range for stability.</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a><span class="sd">            metrics: Current performance metrics</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a><span class="sd">                - latency_p99: 99th percentile latency (ms)</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a><span class="sd">                - throughput_qps: Queries per second</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a><span class="sd">                - error_rate: Error rate (0-1)</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a><span class="sd">                - cost: Deployment cost</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a><span class="sd">            spec: Formal specification with constraints</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a><span class="sd">            previous_metrics: Previous metrics for computing deltas</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a><span class="sd">            Reward in [-1, 1]</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a><span class="sd">        Example:</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a><span class="sd">            &gt;&gt;&gt; learner = ArchitectureLearner()</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a><span class="sd">            &gt;&gt;&gt; metrics = {&quot;latency_p99&quot;: 100, &quot;throughput_qps&quot;: 1000}</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a><span class="sd">            &gt;&gt;&gt; spec = FormalSpecification()</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a><span class="sd">            &gt;&gt;&gt; reward = learner.compute_reward(metrics, spec)</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>        <span class="n">reward</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># Base reward</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>        <span class="c1"># Check constraint satisfaction</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>        <span class="n">constraints_met</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>        <span class="n">constraints_violated</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>        <span class="c1"># Check temporal properties for latency constraints</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>        <span class="k">for</span> <span class="n">prop</span> <span class="ow">in</span> <span class="n">spec</span><span class="o">.</span><span class="n">properties</span> <span class="o">+</span> <span class="n">spec</span><span class="o">.</span><span class="n">invariants</span><span class="p">:</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>            <span class="k">if</span> <span class="n">prop</span><span class="o">.</span><span class="n">time_bound</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>                <span class="c1"># Latency constraint</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>                <span class="n">target_latency</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">time_bound</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>                <span class="n">actual_latency</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;latency_p99&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">))</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>                <span class="k">if</span> <span class="n">actual_latency</span> <span class="o">&lt;=</span> <span class="n">target_latency</span><span class="p">:</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>                    <span class="n">constraints_met</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>                    <span class="n">reward</span> <span class="o">+=</span> <span class="mf">0.1</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>                    <span class="n">constraints_violated</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>                    <span class="n">reward</span> <span class="o">-=</span> <span class="mf">0.5</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>        <span class="c1"># Check throughput requirements (heuristic from predicates)</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>        <span class="n">has_throughput_req</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>            <span class="s2">&quot;throughput&quot;</span> <span class="ow">in</span> <span class="n">prop</span><span class="o">.</span><span class="n">predicate</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>            <span class="k">for</span> <span class="n">prop</span> <span class="ow">in</span> <span class="n">spec</span><span class="o">.</span><span class="n">properties</span> <span class="o">+</span> <span class="n">spec</span><span class="o">.</span><span class="n">invariants</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>        <span class="p">)</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>        <span class="k">if</span> <span class="n">has_throughput_req</span><span class="p">:</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>            <span class="c1"># Assume target throughput of 1000 QPS (could be extracted from spec)</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>            <span class="n">target_throughput</span> <span class="o">=</span> <span class="mf">1000.0</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a>            <span class="n">actual_throughput</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;throughput_qps&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>            <span class="k">if</span> <span class="n">actual_throughput</span> <span class="o">&gt;=</span> <span class="n">target_throughput</span><span class="p">:</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>                <span class="n">constraints_met</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>                <span class="n">reward</span> <span class="o">+=</span> <span class="mf">0.1</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>                <span class="n">constraints_violated</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>                <span class="n">reward</span> <span class="o">-=</span> <span class="mf">0.5</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a>        <span class="c1"># Reward performance improvements over previous metrics</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>        <span class="k">if</span> <span class="n">previous_metrics</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>            <span class="c1"># Latency reduction (lower is better)</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>            <span class="n">prev_latency</span> <span class="o">=</span> <span class="n">previous_metrics</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;latency_p99&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a>            <span class="n">curr_latency</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;latency_p99&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a>            <span class="k">if</span> <span class="n">prev_latency</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a>                <span class="n">latency_delta</span> <span class="o">=</span> <span class="p">(</span><span class="n">prev_latency</span> <span class="o">-</span> <span class="n">curr_latency</span><span class="p">)</span> <span class="o">/</span> <span class="n">prev_latency</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a>                <span class="n">reward</span> <span class="o">+=</span> <span class="n">latency_delta</span>  <span class="c1"># Positive if latency reduced</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a>            <span class="c1"># Throughput increase (higher is better)</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a>            <span class="n">prev_throughput</span> <span class="o">=</span> <span class="n">previous_metrics</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;throughput_qps&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a>            <span class="n">curr_throughput</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;throughput_qps&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a>            <span class="k">if</span> <span class="n">prev_throughput</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a>                <span class="n">throughput_delta</span> <span class="o">=</span> <span class="p">(</span><span class="n">curr_throughput</span> <span class="o">-</span> <span class="n">prev_throughput</span><span class="p">)</span> <span class="o">/</span> <span class="n">prev_throughput</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a>                <span class="n">reward</span> <span class="o">+=</span> <span class="n">throughput_delta</span>  <span class="c1"># Positive if throughput increased</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a>        <span class="c1"># Penalty for high error rate</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a>        <span class="n">error_rate</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;error_rate&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a>        <span class="k">if</span> <span class="n">error_rate</span> <span class="o">&gt;</span> <span class="mf">0.01</span><span class="p">:</span>  <span class="c1"># More than 1% errors</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a>            <span class="n">reward</span> <span class="o">-=</span> <span class="n">error_rate</span> <span class="o">*</span> <span class="mi">10</span>  <span class="c1"># Heavy penalty</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a>        <span class="c1"># Clip reward to [-1, 1]</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a>        <span class="n">reward</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">reward</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a>            <span class="sa">f</span><span class="s2">&quot;Computed reward: </span><span class="si">{</span><span class="n">reward</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> &quot;</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a>            <span class="sa">f</span><span class="s2">&quot;(constraints_met=</span><span class="si">{</span><span class="n">constraints_met</span><span class="si">}</span><span class="s2">, violated=</span><span class="si">{</span><span class="n">constraints_violated</span><span class="si">}</span><span class="s2">)&quot;</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a>        <span class="p">)</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a>        <span class="k">return</span> <span class="n">reward</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">learn_from_metrics</span><span class="p">(</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a>        <span class="n">upir</span><span class="p">:</span> <span class="n">UPIR</span><span class="p">,</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a>        <span class="n">metrics</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a>        <span class="n">previous_metrics</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">UPIR</span><span class="p">:</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a><span class="sd">        Learn from performance metrics and return optimized architecture.</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a><span class="sd">        Main entry point for architecture optimization. This method:</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a><span class="sd">        1. Encodes current architecture as state</span>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a><span class="sd">        2. Selects action using PPO policy</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a><span class="sd">        3. Decodes action to modify architecture</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a><span class="sd">        4. Computes reward from metrics</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a><span class="sd">        5. Stores experience for learning</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a><span class="sd">        6. Updates PPO policy when buffer is full</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a><span class="sd">        7. Returns optimized architecture</span>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a><span class="sd">            upir: Current UPIR</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a><span class="sd">            metrics: Performance metrics from deployment</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a><span class="sd">            previous_metrics: Previous metrics for delta computation</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a><span class="sd">            Optimized UPIR with modified architecture</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a><span class="sd">        Example:</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a><span class="sd">            &gt;&gt;&gt; learner = ArchitectureLearner()</span>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a><span class="sd">            &gt;&gt;&gt; upir = UPIR(id=&quot;test&quot;, name=&quot;Test&quot;, description=&quot;Test&quot;)</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a><span class="sd">            &gt;&gt;&gt; metrics = {&quot;latency_p99&quot;: 100, &quot;throughput_qps&quot;: 1000}</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a><span class="sd">            &gt;&gt;&gt; optimized = learner.learn_from_metrics(upir, metrics)</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a><span class="sd">        References:</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a><span class="sd">        - PPO: Policy gradient with experience replay</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a><span class="sd">        - TD Commons: Continuous optimization loop</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a>        <span class="c1"># 1. Encode current architecture as state</span>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a>        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encode_state</span><span class="p">(</span><span class="n">upir</span><span class="p">)</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a>        <span class="c1"># 2. Select action using PPO policy</span>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a>        <span class="n">action</span><span class="p">,</span> <span class="n">log_prob</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ppo</span><span class="o">.</span><span class="n">select_action</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a>        <span class="c1"># 3. Decode action to modify architecture</span>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a>        <span class="n">optimized_upir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decode_action</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">upir</span><span class="p">)</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a>        <span class="c1"># 4. Compute reward from metrics</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a>        <span class="n">reward</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_reward</span><span class="p">(</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a>            <span class="n">metrics</span><span class="p">,</span>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a>            <span class="n">upir</span><span class="o">.</span><span class="n">specification</span> <span class="k">if</span> <span class="n">upir</span><span class="o">.</span><span class="n">specification</span> <span class="k">else</span> <span class="n">FormalSpecification</span><span class="p">(),</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a>            <span class="n">previous_metrics</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a>        <span class="p">)</span>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a>        <span class="c1"># 5. Store experience</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a>        <span class="c1"># Check if this is terminal (could be based on convergence criteria)</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a>        <span class="n">done</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># For now, never terminal (continuous learning)</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a>        <span class="n">experience</span> <span class="o">=</span> <span class="n">Experience</span><span class="p">(</span>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a>            <span class="n">state</span><span class="o">=</span><span class="n">state</span><span class="p">,</span>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a>            <span class="n">action</span><span class="o">=</span><span class="n">action</span><span class="p">,</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a>            <span class="n">reward</span><span class="o">=</span><span class="n">reward</span><span class="p">,</span>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a>            <span class="n">log_prob</span><span class="o">=</span><span class="n">log_prob</span><span class="p">,</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a>            <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a>            <span class="n">done</span><span class="o">=</span><span class="n">done</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a>        <span class="p">)</span>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">experience_buffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">experience</span><span class="p">)</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a>        <span class="c1"># 6. Update policy if we have enough experiences</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experience_buffer</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">batch_size</span><span class="p">:</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_policy</span><span class="p">()</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a>            <span class="sa">f</span><span class="s2">&quot;Learning step: action=</span><span class="si">{</span><span class="n">action</span><span class="si">}</span><span class="s2">, reward=</span><span class="si">{</span><span class="n">reward</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, &quot;</span>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a>            <span class="sa">f</span><span class="s2">&quot;buffer_size=</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experience_buffer</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a>        <span class="p">)</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a>        <span class="k">return</span> <span class="n">optimized_upir</span>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_update_policy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a><span class="sd">        Update PPO policy using experiences from buffer.</span>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a><span class="sd">        Extracts states, actions, rewards from buffer, computes advantages</span>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a><span class="sd">        using GAE, and performs PPO update.</span>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a>        <span class="c1"># Extract experiences</span>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a>        <span class="n">states</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">exp</span><span class="o">.</span><span class="n">state</span> <span class="k">for</span> <span class="n">exp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">experience_buffer</span><span class="p">])</span>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a>        <span class="n">actions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">exp</span><span class="o">.</span><span class="n">action</span> <span class="k">for</span> <span class="n">exp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">experience_buffer</span><span class="p">])</span>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a>        <span class="n">old_log_probs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">exp</span><span class="o">.</span><span class="n">log_prob</span> <span class="k">for</span> <span class="n">exp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">experience_buffer</span><span class="p">])</span>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a>        <span class="n">rewards</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">exp</span><span class="o">.</span><span class="n">reward</span> <span class="k">for</span> <span class="n">exp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">experience_buffer</span><span class="p">])</span>
<a id="__codelineno-0-507" name="__codelineno-0-507"></a>        <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">exp</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">exp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">experience_buffer</span><span class="p">])</span>
<a id="__codelineno-0-508" name="__codelineno-0-508"></a>        <span class="n">dones</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">exp</span><span class="o">.</span><span class="n">done</span> <span class="k">for</span> <span class="n">exp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">experience_buffer</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<a id="__codelineno-0-509" name="__codelineno-0-509"></a>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a>        <span class="c1"># Compute advantages using GAE</span>
<a id="__codelineno-0-511" name="__codelineno-0-511"></a>        <span class="n">advantages</span><span class="p">,</span> <span class="n">returns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ppo</span><span class="o">.</span><span class="n">compute_gae</span><span class="p">(</span><span class="n">rewards</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">dones</span><span class="p">)</span>
<a id="__codelineno-0-512" name="__codelineno-0-512"></a>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a>        <span class="c1"># Update PPO policy</span>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a>        <span class="n">metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ppo</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">states</span><span class="p">,</span> <span class="n">actions</span><span class="p">,</span> <span class="n">old_log_probs</span><span class="p">,</span> <span class="n">returns</span><span class="p">,</span> <span class="n">advantages</span><span class="p">)</span>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a>            <span class="sa">f</span><span class="s2">&quot;Policy update: policy_loss=</span><span class="si">{</span><span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;policy_loss&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, &quot;</span>
<a id="__codelineno-0-518" name="__codelineno-0-518"></a>            <span class="sa">f</span><span class="s2">&quot;value_loss=</span><span class="si">{</span><span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;value_loss&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, &quot;</span>
<a id="__codelineno-0-519" name="__codelineno-0-519"></a>            <span class="sa">f</span><span class="s2">&quot;entropy=</span><span class="si">{</span><span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;entropy&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a>        <span class="p">)</span>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a>        <span class="c1"># Clear buffer after update</span>
<a id="__codelineno-0-523" name="__codelineno-0-523"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">experience_buffer</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
<a id="__codelineno-0-524" name="__codelineno-0-524"></a>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;String representation.&quot;&quot;&quot;</span>
<a id="__codelineno-0-527" name="__codelineno-0-527"></a>        <span class="k">return</span> <span class="p">(</span>
<a id="__codelineno-0-528" name="__codelineno-0-528"></a>            <span class="sa">f</span><span class="s2">&quot;ArchitectureLearner(state_dim=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">state_dim</span><span class="si">}</span><span class="s2">, &quot;</span>
<a id="__codelineno-0-529" name="__codelineno-0-529"></a>            <span class="sa">f</span><span class="s2">&quot;action_dim=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">action_dim</span><span class="si">}</span><span class="s2">, &quot;</span>
<a id="__codelineno-0-530" name="__codelineno-0-530"></a>            <span class="sa">f</span><span class="s2">&quot;buffer=</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experience_buffer</span><span class="p">)</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">experience_buffer</span><span class="o">.</span><span class="n">maxlen</span><span class="si">}</span><span class="s2">)&quot;</span>
<a id="__codelineno-0-531" name="__codelineno-0-531"></a>        <span class="p">)</span>
<a id="__codelineno-0-532" name="__codelineno-0-532"></a>
<a id="__codelineno-0-533" name="__codelineno-0-533"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-534" name="__codelineno-0-534"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Developer-friendly representation.&quot;&quot;&quot;</span>
<a id="__codelineno-0-535" name="__codelineno-0-535"></a>        <span class="k">return</span> <span class="p">(</span>
<a id="__codelineno-0-536" name="__codelineno-0-536"></a>            <span class="sa">f</span><span class="s2">&quot;ArchitectureLearner(state_dim=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">state_dim</span><span class="si">}</span><span class="s2">, &quot;</span>
<a id="__codelineno-0-537" name="__codelineno-0-537"></a>            <span class="sa">f</span><span class="s2">&quot;action_dim=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">action_dim</span><span class="si">}</span><span class="s2">, &quot;</span>
<a id="__codelineno-0-538" name="__codelineno-0-538"></a>            <span class="sa">f</span><span class="s2">&quot;config=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="si">}</span><span class="s2">)&quot;</span>
<a id="__codelineno-0-539" name="__codelineno-0-539"></a>        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">








<h3 id="upir.learning.learner.ArchitectureLearner-functions">Functions<a href="#upir.learning.learner.ArchitectureLearner-functions" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-function">


<h4 id="upir.learning.learner.ArchitectureLearner.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">state_dim</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">action_dim</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">buffer_size</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span></code>

<a href="#upir.learning.learner.ArchitectureLearner.__init__" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Initialize architecture learner.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state_dim</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dimension of state encoding (default 64)</p>
              </div>
            </td>
            <td>
                  <code>64</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>action_dim</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of possible actions (default 40)</p>
              </div>
            </td>
            <td>
                  <code>40</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>config</code>
            </td>
            <td>
                  <code><span title="upir.learning.ppo.PPOConfig">PPOConfig</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>PPO configuration (uses defaults if None)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>buffer_size</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum size of experience buffer</p>
              </div>
            </td>
            <td>
                  <code>1000</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>upir/learning/learner.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>    <span class="n">state_dim</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">64</span><span class="p">,</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>    <span class="n">action_dim</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">40</span><span class="p">,</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>    <span class="n">config</span><span class="p">:</span> <span class="n">PPOConfig</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>    <span class="n">buffer_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="p">):</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="sd">    Initialize architecture learner.</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="sd">        state_dim: Dimension of state encoding (default 64)</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="sd">        action_dim: Number of possible actions (default 40)</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="sd">        config: PPO configuration (uses defaults if None)</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="sd">        buffer_size: Maximum size of experience buffer</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">state_dim</span> <span class="o">=</span> <span class="n">state_dim</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">action_dim</span> <span class="o">=</span> <span class="n">action_dim</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span> <span class="ow">or</span> <span class="n">PPOConfig</span><span class="p">()</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>    <span class="c1"># Initialize PPO agent</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">ppo</span> <span class="o">=</span> <span class="n">PPO</span><span class="p">(</span><span class="n">state_dim</span><span class="o">=</span><span class="n">state_dim</span><span class="p">,</span> <span class="n">action_dim</span><span class="o">=</span><span class="n">action_dim</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">)</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>    <span class="c1"># Experience buffer for training</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">experience_buffer</span><span class="p">:</span> <span class="n">Deque</span><span class="p">[</span><span class="n">Experience</span><span class="p">]</span> <span class="o">=</span> <span class="n">deque</span><span class="p">(</span><span class="n">maxlen</span><span class="o">=</span><span class="n">buffer_size</span><span class="p">)</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>    <span class="c1"># Feature normalization stats (updated online)</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">feature_stats</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>        <span class="s2">&quot;num_components_max&quot;</span><span class="p">:</span> <span class="mf">100.0</span><span class="p">,</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>        <span class="s2">&quot;num_connections_max&quot;</span><span class="p">:</span> <span class="mf">200.0</span><span class="p">,</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>        <span class="s2">&quot;avg_latency_max&quot;</span><span class="p">:</span> <span class="mf">10000.0</span><span class="p">,</span>  <span class="c1"># 10 seconds in ms</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>        <span class="s2">&quot;total_throughput_max&quot;</span><span class="p">:</span> <span class="mf">100000.0</span><span class="p">,</span>  <span class="c1"># 100k QPS</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>        <span class="s2">&quot;complexity_max&quot;</span><span class="p">:</span> <span class="mf">1000.0</span><span class="p">,</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>    <span class="p">}</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>        <span class="sa">f</span><span class="s2">&quot;Initialized ArchitectureLearner: state_dim=</span><span class="si">{</span><span class="n">state_dim</span><span class="si">}</span><span class="s2">, &quot;</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>        <span class="sa">f</span><span class="s2">&quot;action_dim=</span><span class="si">{</span><span class="n">action_dim</span><span class="si">}</span><span class="s2">, buffer_size=</span><span class="si">{</span><span class="n">buffer_size</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="upir.learning.learner.ArchitectureLearner.encode_state" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">encode_state</span><span class="p">(</span><span class="n">upir</span><span class="p">)</span></code>

<a href="#upir.learning.learner.ArchitectureLearner.encode_state" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Encode UPIR architecture as fixed-size state vector.</p>
<p>Extracts architectural features and normalizes to [0, 1] range:
- Number of components
- Number of connections
- Average component latency
- Total throughput capacity
- Deployment complexity score</p>
<p>The state is padded to fixed size (state_dim) for consistent input.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>upir</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="upir.core.upir.UPIR


  
      dataclass
  " href="../../core/upir/#upir.core.upir.UPIR">UPIR</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>UPIR to encode</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>State vector (state_dim,) with values in [0, 1]</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>learner = ArchitectureLearner()
upir = UPIR(id="test", name="Test", description="Test")
state = learner.encode_state(upir)
state.shape
(64,)
assert np.all((state &gt;= 0) &amp; (state &lt;= 1))</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>upir/learning/learner.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="k">def</span><span class="w"> </span><span class="nf">encode_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">upir</span><span class="p">:</span> <span class="n">UPIR</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="sd">    Encode UPIR architecture as fixed-size state vector.</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">    Extracts architectural features and normalizes to [0, 1] range:</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="sd">    - Number of components</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="sd">    - Number of connections</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="sd">    - Average component latency</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="sd">    - Total throughput capacity</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a><span class="sd">    - Deployment complexity score</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="sd">    The state is padded to fixed size (state_dim) for consistent input.</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="sd">        upir: UPIR to encode</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a><span class="sd">        State vector (state_dim,) with values in [0, 1]</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a><span class="sd">    Example:</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a><span class="sd">        &gt;&gt;&gt; learner = ArchitectureLearner()</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a><span class="sd">        &gt;&gt;&gt; upir = UPIR(id=&quot;test&quot;, name=&quot;Test&quot;, description=&quot;Test&quot;)</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a><span class="sd">        &gt;&gt;&gt; state = learner.encode_state(upir)</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a><span class="sd">        &gt;&gt;&gt; state.shape</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a><span class="sd">        (64,)</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a><span class="sd">        &gt;&gt;&gt; assert np.all((state &gt;= 0) &amp; (state &lt;= 1))</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>    <span class="k">if</span> <span class="n">upir</span><span class="o">.</span><span class="n">architecture</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>        <span class="c1"># No architecture - return zero state</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state_dim</span><span class="p">)</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>    <span class="n">arch</span> <span class="o">=</span> <span class="n">upir</span><span class="o">.</span><span class="n">architecture</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>    <span class="c1"># Extract basic features</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>    <span class="n">num_components</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">arch</span><span class="o">.</span><span class="n">components</span><span class="p">)</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>    <span class="n">num_connections</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">arch</span><span class="o">.</span><span class="n">connections</span><span class="p">)</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>    <span class="c1"># Compute average latency (if components have latency info)</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>    <span class="n">total_latency</span> <span class="o">=</span> <span class="mf">0.0</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>    <span class="n">latency_count</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>    <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="n">arch</span><span class="o">.</span><span class="n">components</span><span class="p">:</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;latency_ms&quot;</span> <span class="ow">in</span> <span class="n">comp</span><span class="p">:</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>            <span class="n">total_latency</span> <span class="o">+=</span> <span class="n">comp</span><span class="p">[</span><span class="s2">&quot;latency_ms&quot;</span><span class="p">]</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>            <span class="n">latency_count</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>    <span class="n">avg_latency</span> <span class="o">=</span> <span class="n">total_latency</span> <span class="o">/</span> <span class="n">latency_count</span> <span class="k">if</span> <span class="n">latency_count</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mf">0.0</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>    <span class="c1"># Compute total throughput (if components have throughput info)</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>    <span class="n">total_throughput</span> <span class="o">=</span> <span class="mf">0.0</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>    <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="n">arch</span><span class="o">.</span><span class="n">components</span><span class="p">:</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;throughput_qps&quot;</span> <span class="ow">in</span> <span class="n">comp</span><span class="p">:</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>            <span class="n">total_throughput</span> <span class="o">+=</span> <span class="n">comp</span><span class="p">[</span><span class="s2">&quot;throughput_qps&quot;</span><span class="p">]</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>    <span class="c1"># Compute deployment complexity (simple heuristic)</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>    <span class="c1"># Based on number of components and connections</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>    <span class="n">complexity</span> <span class="o">=</span> <span class="n">num_components</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">+</span> <span class="n">num_connections</span> <span class="o">*</span> <span class="mi">5</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>    <span class="c1"># Normalize features to [0, 1]</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>    <span class="n">features</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>        <span class="n">num_components</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_stats</span><span class="p">[</span><span class="s2">&quot;num_components_max&quot;</span><span class="p">],</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>        <span class="n">num_connections</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_stats</span><span class="p">[</span><span class="s2">&quot;num_connections_max&quot;</span><span class="p">],</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>        <span class="n">avg_latency</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_stats</span><span class="p">[</span><span class="s2">&quot;avg_latency_max&quot;</span><span class="p">],</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>        <span class="n">total_throughput</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_stats</span><span class="p">[</span><span class="s2">&quot;total_throughput_max&quot;</span><span class="p">],</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>        <span class="n">complexity</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_stats</span><span class="p">[</span><span class="s2">&quot;complexity_max&quot;</span><span class="p">],</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>    <span class="p">])</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>    <span class="c1"># Clip to [0, 1] range</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>    <span class="n">features</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>    <span class="c1"># Add per-component features (latency, throughput, parallelism)</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>    <span class="n">component_features</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>    <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="n">arch</span><span class="o">.</span><span class="n">components</span><span class="p">[:</span><span class="mi">10</span><span class="p">]:</span>  <span class="c1"># Max 10 components</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>            <span class="n">comp_latency</span> <span class="o">=</span> <span class="n">comp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;latency_ms&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>            <span class="n">comp_throughput</span> <span class="o">=</span> <span class="n">comp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;throughput_qps&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>            <span class="n">comp_parallelism</span> <span class="o">=</span> <span class="n">comp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;parallelism&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>            <span class="n">component_features</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>                <span class="n">comp_latency</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_stats</span><span class="p">[</span><span class="s2">&quot;avg_latency_max&quot;</span><span class="p">],</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>                <span class="n">comp_throughput</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_stats</span><span class="p">[</span><span class="s2">&quot;total_throughput_max&quot;</span><span class="p">],</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>                <span class="n">comp_parallelism</span> <span class="o">/</span> <span class="mf">100.0</span><span class="p">,</span>  <span class="c1"># Normalize to [0, 1] assuming max 100</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>            <span class="p">])</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>    <span class="c1"># Pad to fixed size</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>    <span class="n">all_features</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">features</span><span class="p">,</span> <span class="n">component_features</span><span class="p">])</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>    <span class="c1"># Clip all features to [0, 1] range</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>    <span class="n">all_features</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">all_features</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_features</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_dim</span><span class="p">:</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>        <span class="c1"># Pad with zeros</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>        <span class="n">all_features</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>            <span class="n">all_features</span><span class="p">,</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_dim</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_features</span><span class="p">)),</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;constant&quot;</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>        <span class="p">)</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>        <span class="c1"># Truncate if too long</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>        <span class="n">all_features</span> <span class="o">=</span> <span class="n">all_features</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">state_dim</span><span class="p">]</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>    <span class="k">return</span> <span class="n">all_features</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="upir.learning.learner.ArchitectureLearner.decode_action" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">decode_action</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">upir</span><span class="p">)</span></code>

<a href="#upir.learning.learner.ArchitectureLearner.decode_action" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Decode action and apply architectural modification.</p>
<p>Actions represent different architectural changes:
- 0-9: Increase parallelism of component i
- 10-19: Decrease parallelism of component i
- 20-29: Change component type (e.g., batch -&gt; streaming)
- 30-39: Modify connection (add/remove)</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>action</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Action index (0 to action_dim-1)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>upir</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="upir.core.upir.UPIR


  
      dataclass
  " href="../../core/upir/#upir.core.upir.UPIR">UPIR</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Current UPIR</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="upir.core.upir.UPIR


  
      dataclass
  " href="../../core/upir/#upir.core.upir.UPIR">UPIR</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Modified UPIR with architectural change applied</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>learner = ArchitectureLearner()
upir = UPIR(id="test", name="Test", description="Test")
modified = learner.decode_action(0, upir)</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>upir/learning/learner.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-225" name="__codelineno-0-225"></a><span class="k">def</span><span class="w"> </span><span class="nf">decode_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">upir</span><span class="p">:</span> <span class="n">UPIR</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">UPIR</span><span class="p">:</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a><span class="sd">    Decode action and apply architectural modification.</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a><span class="sd">    Actions represent different architectural changes:</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a><span class="sd">    - 0-9: Increase parallelism of component i</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a><span class="sd">    - 10-19: Decrease parallelism of component i</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a><span class="sd">    - 20-29: Change component type (e.g., batch -&gt; streaming)</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a><span class="sd">    - 30-39: Modify connection (add/remove)</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a><span class="sd">        action: Action index (0 to action_dim-1)</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a><span class="sd">        upir: Current UPIR</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a><span class="sd">        Modified UPIR with architectural change applied</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a><span class="sd">    Example:</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a><span class="sd">        &gt;&gt;&gt; learner = ArchitectureLearner()</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a><span class="sd">        &gt;&gt;&gt; upir = UPIR(id=&quot;test&quot;, name=&quot;Test&quot;, description=&quot;Test&quot;)</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a><span class="sd">        &gt;&gt;&gt; modified = learner.decode_action(0, upir)</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>    <span class="c1"># Create copy to avoid modifying original</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>    <span class="n">modified_upir</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">upir</span><span class="p">)</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>    <span class="k">if</span> <span class="n">modified_upir</span><span class="o">.</span><span class="n">architecture</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No architecture to modify&quot;</span><span class="p">)</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>        <span class="k">return</span> <span class="n">modified_upir</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>    <span class="n">arch</span> <span class="o">=</span> <span class="n">modified_upir</span><span class="o">.</span><span class="n">architecture</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>    <span class="n">num_components</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">arch</span><span class="o">.</span><span class="n">components</span><span class="p">)</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>    <span class="k">if</span> <span class="n">num_components</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No components to modify&quot;</span><span class="p">)</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>        <span class="k">return</span> <span class="n">modified_upir</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>    <span class="c1"># Decode action type and target</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>    <span class="k">if</span> <span class="n">action</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>        <span class="c1"># Increase parallelism of component (action % num_components)</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>        <span class="n">component_idx</span> <span class="o">=</span> <span class="n">action</span> <span class="o">%</span> <span class="n">num_components</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>        <span class="n">comp</span> <span class="o">=</span> <span class="n">arch</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">component_idx</span><span class="p">]</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>        <span class="n">current_parallelism</span> <span class="o">=</span> <span class="n">comp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;parallelism&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>        <span class="n">new_parallelism</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">current_parallelism</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>        <span class="n">comp</span><span class="p">[</span><span class="s2">&quot;parallelism&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_parallelism</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>            <span class="sa">f</span><span class="s2">&quot;Action </span><span class="si">{</span><span class="n">action</span><span class="si">}</span><span class="s2">: Increase parallelism of </span><span class="si">{</span><span class="n">comp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="w"> </span><span class="sa">f</span><span class="s1">&#39;comp_</span><span class="si">{</span><span class="n">component_idx</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> &quot;</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>            <span class="sa">f</span><span class="s2">&quot;from </span><span class="si">{</span><span class="n">current_parallelism</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">new_parallelism</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>        <span class="p">)</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>    <span class="k">elif</span> <span class="n">action</span> <span class="o">&lt;</span> <span class="mi">20</span><span class="p">:</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>        <span class="c1"># Decrease parallelism of component</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>        <span class="n">component_idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">action</span> <span class="o">-</span> <span class="mi">10</span><span class="p">)</span> <span class="o">%</span> <span class="n">num_components</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>        <span class="n">comp</span> <span class="o">=</span> <span class="n">arch</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">component_idx</span><span class="p">]</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>        <span class="n">current_parallelism</span> <span class="o">=</span> <span class="n">comp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;parallelism&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>        <span class="n">new_parallelism</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">current_parallelism</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>        <span class="n">comp</span><span class="p">[</span><span class="s2">&quot;parallelism&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_parallelism</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>            <span class="sa">f</span><span class="s2">&quot;Action </span><span class="si">{</span><span class="n">action</span><span class="si">}</span><span class="s2">: Decrease parallelism of </span><span class="si">{</span><span class="n">comp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="w"> </span><span class="sa">f</span><span class="s1">&#39;comp_</span><span class="si">{</span><span class="n">component_idx</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> &quot;</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>            <span class="sa">f</span><span class="s2">&quot;from </span><span class="si">{</span><span class="n">current_parallelism</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">new_parallelism</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>        <span class="p">)</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>    <span class="k">elif</span> <span class="n">action</span> <span class="o">&lt;</span> <span class="mi">30</span><span class="p">:</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>        <span class="c1"># Change component type (simplified: toggle between batch/streaming)</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>        <span class="n">component_idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">action</span> <span class="o">-</span> <span class="mi">20</span><span class="p">)</span> <span class="o">%</span> <span class="n">num_components</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>        <span class="n">comp</span> <span class="o">=</span> <span class="n">arch</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">component_idx</span><span class="p">]</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>        <span class="n">current_type</span> <span class="o">=</span> <span class="n">comp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;processor&quot;</span><span class="p">)</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>        <span class="k">if</span> <span class="s2">&quot;streaming&quot;</span> <span class="ow">in</span> <span class="n">current_type</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>            <span class="n">new_type</span> <span class="o">=</span> <span class="s2">&quot;batch_processor&quot;</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>            <span class="n">new_type</span> <span class="o">=</span> <span class="s2">&quot;streaming_processor&quot;</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>        <span class="n">comp</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_type</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>            <span class="sa">f</span><span class="s2">&quot;Action </span><span class="si">{</span><span class="n">action</span><span class="si">}</span><span class="s2">: Change type of </span><span class="si">{</span><span class="n">comp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="w"> </span><span class="sa">f</span><span class="s1">&#39;comp_</span><span class="si">{</span><span class="n">component_idx</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> &quot;</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>            <span class="sa">f</span><span class="s2">&quot;from </span><span class="si">{</span><span class="n">current_type</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">new_type</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>        <span class="p">)</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>        <span class="c1"># Modify connection (simplified: toggle connection property)</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arch</span><span class="o">.</span><span class="n">connections</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>            <span class="n">connection_idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">action</span> <span class="o">-</span> <span class="mi">30</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">arch</span><span class="o">.</span><span class="n">connections</span><span class="p">)</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>            <span class="n">conn</span> <span class="o">=</span> <span class="n">arch</span><span class="o">.</span><span class="n">connections</span><span class="p">[</span><span class="n">connection_idx</span><span class="p">]</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>            <span class="c1"># Toggle &quot;batched&quot; property</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>            <span class="n">current_batched</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;batched&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>            <span class="n">conn</span><span class="p">[</span><span class="s2">&quot;batched&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">current_batched</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>                <span class="sa">f</span><span class="s2">&quot;Action </span><span class="si">{</span><span class="n">action</span><span class="si">}</span><span class="s2">: Toggle batched for connection &quot;</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">conn</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;from&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;?&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">-&gt;</span><span class="si">{</span><span class="n">conn</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;to&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;?&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="ow">not</span><span class="w"> </span><span class="n">current_batched</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>            <span class="p">)</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>    <span class="k">return</span> <span class="n">modified_upir</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="upir.learning.learner.ArchitectureLearner.compute_reward" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute_reward</span><span class="p">(</span><span class="n">metrics</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">previous_metrics</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#upir.learning.learner.ArchitectureLearner.compute_reward" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Compute reward from performance metrics and specification.</p>
<p>Reward structure:
- Base reward: 1.0
- Constraint satisfaction: +0.1 per met constraint, -0.5 per violation
- Performance improvement: +delta/target for improvements</p>
<p>Rewards are clipped to [-1, 1] range for stability.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>metrics</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Current performance metrics
- latency_p99: 99th percentile latency (ms)
- throughput_qps: Queries per second
- error_rate: Error rate (0-1)
- cost: Deployment cost</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>spec</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="upir.core.specification.FormalSpecification


  
      dataclass
  " href="../../core/specification/#upir.core.specification.FormalSpecification">FormalSpecification</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Formal specification with constraints</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>previous_metrics</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Previous metrics for computing deltas</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Reward in [-1, 1]</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>learner = ArchitectureLearner()
metrics = {"latency_p99": 100, "throughput_qps": 1000}
spec = FormalSpecification()
reward = learner.compute_reward(metrics, spec)</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>upir/learning/learner.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-316" name="__codelineno-0-316"></a><span class="k">def</span><span class="w"> </span><span class="nf">compute_reward</span><span class="p">(</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>    <span class="n">metrics</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>    <span class="n">spec</span><span class="p">:</span> <span class="n">FormalSpecification</span><span class="p">,</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>    <span class="n">previous_metrics</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a><span class="sd">    Compute reward from performance metrics and specification.</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a><span class="sd">    Reward structure:</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a><span class="sd">    - Base reward: 1.0</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a><span class="sd">    - Constraint satisfaction: +0.1 per met constraint, -0.5 per violation</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a><span class="sd">    - Performance improvement: +delta/target for improvements</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a><span class="sd">    Rewards are clipped to [-1, 1] range for stability.</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a><span class="sd">        metrics: Current performance metrics</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a><span class="sd">            - latency_p99: 99th percentile latency (ms)</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a><span class="sd">            - throughput_qps: Queries per second</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a><span class="sd">            - error_rate: Error rate (0-1)</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a><span class="sd">            - cost: Deployment cost</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a><span class="sd">        spec: Formal specification with constraints</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a><span class="sd">        previous_metrics: Previous metrics for computing deltas</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a><span class="sd">        Reward in [-1, 1]</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a><span class="sd">    Example:</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a><span class="sd">        &gt;&gt;&gt; learner = ArchitectureLearner()</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a><span class="sd">        &gt;&gt;&gt; metrics = {&quot;latency_p99&quot;: 100, &quot;throughput_qps&quot;: 1000}</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a><span class="sd">        &gt;&gt;&gt; spec = FormalSpecification()</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a><span class="sd">        &gt;&gt;&gt; reward = learner.compute_reward(metrics, spec)</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>    <span class="n">reward</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># Base reward</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>    <span class="c1"># Check constraint satisfaction</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>    <span class="n">constraints_met</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>    <span class="n">constraints_violated</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>    <span class="c1"># Check temporal properties for latency constraints</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>    <span class="k">for</span> <span class="n">prop</span> <span class="ow">in</span> <span class="n">spec</span><span class="o">.</span><span class="n">properties</span> <span class="o">+</span> <span class="n">spec</span><span class="o">.</span><span class="n">invariants</span><span class="p">:</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>        <span class="k">if</span> <span class="n">prop</span><span class="o">.</span><span class="n">time_bound</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>            <span class="c1"># Latency constraint</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>            <span class="n">target_latency</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">time_bound</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>            <span class="n">actual_latency</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;latency_p99&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">))</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>            <span class="k">if</span> <span class="n">actual_latency</span> <span class="o">&lt;=</span> <span class="n">target_latency</span><span class="p">:</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>                <span class="n">constraints_met</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>                <span class="n">reward</span> <span class="o">+=</span> <span class="mf">0.1</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>                <span class="n">constraints_violated</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>                <span class="n">reward</span> <span class="o">-=</span> <span class="mf">0.5</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>    <span class="c1"># Check throughput requirements (heuristic from predicates)</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>    <span class="n">has_throughput_req</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>        <span class="s2">&quot;throughput&quot;</span> <span class="ow">in</span> <span class="n">prop</span><span class="o">.</span><span class="n">predicate</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>        <span class="k">for</span> <span class="n">prop</span> <span class="ow">in</span> <span class="n">spec</span><span class="o">.</span><span class="n">properties</span> <span class="o">+</span> <span class="n">spec</span><span class="o">.</span><span class="n">invariants</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>    <span class="p">)</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>    <span class="k">if</span> <span class="n">has_throughput_req</span><span class="p">:</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>        <span class="c1"># Assume target throughput of 1000 QPS (could be extracted from spec)</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>        <span class="n">target_throughput</span> <span class="o">=</span> <span class="mf">1000.0</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a>        <span class="n">actual_throughput</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;throughput_qps&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>        <span class="k">if</span> <span class="n">actual_throughput</span> <span class="o">&gt;=</span> <span class="n">target_throughput</span><span class="p">:</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>            <span class="n">constraints_met</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>            <span class="n">reward</span> <span class="o">+=</span> <span class="mf">0.1</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>            <span class="n">constraints_violated</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>            <span class="n">reward</span> <span class="o">-=</span> <span class="mf">0.5</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a>    <span class="c1"># Reward performance improvements over previous metrics</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>    <span class="k">if</span> <span class="n">previous_metrics</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>        <span class="c1"># Latency reduction (lower is better)</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>        <span class="n">prev_latency</span> <span class="o">=</span> <span class="n">previous_metrics</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;latency_p99&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a>        <span class="n">curr_latency</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;latency_p99&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a>        <span class="k">if</span> <span class="n">prev_latency</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a>            <span class="n">latency_delta</span> <span class="o">=</span> <span class="p">(</span><span class="n">prev_latency</span> <span class="o">-</span> <span class="n">curr_latency</span><span class="p">)</span> <span class="o">/</span> <span class="n">prev_latency</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a>            <span class="n">reward</span> <span class="o">+=</span> <span class="n">latency_delta</span>  <span class="c1"># Positive if latency reduced</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a>        <span class="c1"># Throughput increase (higher is better)</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a>        <span class="n">prev_throughput</span> <span class="o">=</span> <span class="n">previous_metrics</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;throughput_qps&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a>        <span class="n">curr_throughput</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;throughput_qps&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a>        <span class="k">if</span> <span class="n">prev_throughput</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a>            <span class="n">throughput_delta</span> <span class="o">=</span> <span class="p">(</span><span class="n">curr_throughput</span> <span class="o">-</span> <span class="n">prev_throughput</span><span class="p">)</span> <span class="o">/</span> <span class="n">prev_throughput</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a>            <span class="n">reward</span> <span class="o">+=</span> <span class="n">throughput_delta</span>  <span class="c1"># Positive if throughput increased</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a>    <span class="c1"># Penalty for high error rate</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a>    <span class="n">error_rate</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;error_rate&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a>    <span class="k">if</span> <span class="n">error_rate</span> <span class="o">&gt;</span> <span class="mf">0.01</span><span class="p">:</span>  <span class="c1"># More than 1% errors</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a>        <span class="n">reward</span> <span class="o">-=</span> <span class="n">error_rate</span> <span class="o">*</span> <span class="mi">10</span>  <span class="c1"># Heavy penalty</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a>    <span class="c1"># Clip reward to [-1, 1]</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a>    <span class="n">reward</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">reward</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a>        <span class="sa">f</span><span class="s2">&quot;Computed reward: </span><span class="si">{</span><span class="n">reward</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> &quot;</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a>        <span class="sa">f</span><span class="s2">&quot;(constraints_met=</span><span class="si">{</span><span class="n">constraints_met</span><span class="si">}</span><span class="s2">, violated=</span><span class="si">{</span><span class="n">constraints_violated</span><span class="si">}</span><span class="s2">)&quot;</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a>    <span class="p">)</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a>    <span class="k">return</span> <span class="n">reward</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="upir.learning.learner.ArchitectureLearner.learn_from_metrics" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">learn_from_metrics</span><span class="p">(</span><span class="n">upir</span><span class="p">,</span> <span class="n">metrics</span><span class="p">,</span> <span class="n">previous_metrics</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#upir.learning.learner.ArchitectureLearner.learn_from_metrics" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Learn from performance metrics and return optimized architecture.</p>
<p>Main entry point for architecture optimization. This method:
1. Encodes current architecture as state
2. Selects action using PPO policy
3. Decodes action to modify architecture
4. Computes reward from metrics
5. Stores experience for learning
6. Updates PPO policy when buffer is full
7. Returns optimized architecture</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>upir</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="upir.core.upir.UPIR


  
      dataclass
  " href="../../core/upir/#upir.core.upir.UPIR">UPIR</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Current UPIR</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>metrics</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Performance metrics from deployment</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>previous_metrics</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Previous metrics for delta computation</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="upir.core.upir.UPIR


  
      dataclass
  " href="../../core/upir/#upir.core.upir.UPIR">UPIR</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optimized UPIR with modified architecture</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>learner = ArchitectureLearner()
upir = UPIR(id="test", name="Test", description="Test")
metrics = {"latency_p99": 100, "throughput_qps": 1000}
optimized = learner.learn_from_metrics(upir, metrics)</p>
</blockquote>
</blockquote>
</blockquote>
</details>        <p>References:
- PPO: Policy gradient with experience replay
- TD Commons: Continuous optimization loop</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>upir/learning/learner.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-418" name="__codelineno-0-418"></a><span class="k">def</span><span class="w"> </span><span class="nf">learn_from_metrics</span><span class="p">(</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a>    <span class="n">upir</span><span class="p">:</span> <span class="n">UPIR</span><span class="p">,</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a>    <span class="n">metrics</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a>    <span class="n">previous_metrics</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">UPIR</span><span class="p">:</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a><span class="sd">    Learn from performance metrics and return optimized architecture.</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a><span class="sd">    Main entry point for architecture optimization. This method:</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a><span class="sd">    1. Encodes current architecture as state</span>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a><span class="sd">    2. Selects action using PPO policy</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a><span class="sd">    3. Decodes action to modify architecture</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a><span class="sd">    4. Computes reward from metrics</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a><span class="sd">    5. Stores experience for learning</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a><span class="sd">    6. Updates PPO policy when buffer is full</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a><span class="sd">    7. Returns optimized architecture</span>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a><span class="sd">        upir: Current UPIR</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a><span class="sd">        metrics: Performance metrics from deployment</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a><span class="sd">        previous_metrics: Previous metrics for delta computation</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a><span class="sd">        Optimized UPIR with modified architecture</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a><span class="sd">    Example:</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a><span class="sd">        &gt;&gt;&gt; learner = ArchitectureLearner()</span>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a><span class="sd">        &gt;&gt;&gt; upir = UPIR(id=&quot;test&quot;, name=&quot;Test&quot;, description=&quot;Test&quot;)</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a><span class="sd">        &gt;&gt;&gt; metrics = {&quot;latency_p99&quot;: 100, &quot;throughput_qps&quot;: 1000}</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a><span class="sd">        &gt;&gt;&gt; optimized = learner.learn_from_metrics(upir, metrics)</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a><span class="sd">    References:</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a><span class="sd">    - PPO: Policy gradient with experience replay</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a><span class="sd">    - TD Commons: Continuous optimization loop</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a>    <span class="c1"># 1. Encode current architecture as state</span>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a>    <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encode_state</span><span class="p">(</span><span class="n">upir</span><span class="p">)</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a>    <span class="c1"># 2. Select action using PPO policy</span>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a>    <span class="n">action</span><span class="p">,</span> <span class="n">log_prob</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ppo</span><span class="o">.</span><span class="n">select_action</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a>    <span class="c1"># 3. Decode action to modify architecture</span>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a>    <span class="n">optimized_upir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decode_action</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">upir</span><span class="p">)</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a>    <span class="c1"># 4. Compute reward from metrics</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a>    <span class="n">reward</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_reward</span><span class="p">(</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a>        <span class="n">metrics</span><span class="p">,</span>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a>        <span class="n">upir</span><span class="o">.</span><span class="n">specification</span> <span class="k">if</span> <span class="n">upir</span><span class="o">.</span><span class="n">specification</span> <span class="k">else</span> <span class="n">FormalSpecification</span><span class="p">(),</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a>        <span class="n">previous_metrics</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a>    <span class="p">)</span>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a>    <span class="c1"># 5. Store experience</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a>    <span class="c1"># Check if this is terminal (could be based on convergence criteria)</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a>    <span class="n">done</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># For now, never terminal (continuous learning)</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a>    <span class="n">experience</span> <span class="o">=</span> <span class="n">Experience</span><span class="p">(</span>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a>        <span class="n">state</span><span class="o">=</span><span class="n">state</span><span class="p">,</span>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a>        <span class="n">action</span><span class="o">=</span><span class="n">action</span><span class="p">,</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a>        <span class="n">reward</span><span class="o">=</span><span class="n">reward</span><span class="p">,</span>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a>        <span class="n">log_prob</span><span class="o">=</span><span class="n">log_prob</span><span class="p">,</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a>        <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a>        <span class="n">done</span><span class="o">=</span><span class="n">done</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a>    <span class="p">)</span>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">experience_buffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">experience</span><span class="p">)</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a>    <span class="c1"># 6. Update policy if we have enough experiences</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experience_buffer</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">batch_size</span><span class="p">:</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_update_policy</span><span class="p">()</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a>        <span class="sa">f</span><span class="s2">&quot;Learning step: action=</span><span class="si">{</span><span class="n">action</span><span class="si">}</span><span class="s2">, reward=</span><span class="si">{</span><span class="n">reward</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, &quot;</span>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a>        <span class="sa">f</span><span class="s2">&quot;buffer_size=</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experience_buffer</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a>    <span class="p">)</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a>    <span class="k">return</span> <span class="n">optimized_upir</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="upir.learning.learner.ArchitectureLearner.__str__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__str__</span><span class="p">()</span></code>

<a href="#upir.learning.learner.ArchitectureLearner.__str__" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>String representation.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>upir/learning/learner.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-525">525</a></span>
<span class="normal"><a href="#__codelineno-0-526">526</a></span>
<span class="normal"><a href="#__codelineno-0-527">527</a></span>
<span class="normal"><a href="#__codelineno-0-528">528</a></span>
<span class="normal"><a href="#__codelineno-0-529">529</a></span>
<span class="normal"><a href="#__codelineno-0-530">530</a></span>
<span class="normal"><a href="#__codelineno-0-531">531</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-525" name="__codelineno-0-525"></a><span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;String representation.&quot;&quot;&quot;</span>
<a id="__codelineno-0-527" name="__codelineno-0-527"></a>    <span class="k">return</span> <span class="p">(</span>
<a id="__codelineno-0-528" name="__codelineno-0-528"></a>        <span class="sa">f</span><span class="s2">&quot;ArchitectureLearner(state_dim=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">state_dim</span><span class="si">}</span><span class="s2">, &quot;</span>
<a id="__codelineno-0-529" name="__codelineno-0-529"></a>        <span class="sa">f</span><span class="s2">&quot;action_dim=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">action_dim</span><span class="si">}</span><span class="s2">, &quot;</span>
<a id="__codelineno-0-530" name="__codelineno-0-530"></a>        <span class="sa">f</span><span class="s2">&quot;buffer=</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experience_buffer</span><span class="p">)</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">experience_buffer</span><span class="o">.</span><span class="n">maxlen</span><span class="si">}</span><span class="s2">)&quot;</span>
<a id="__codelineno-0-531" name="__codelineno-0-531"></a>    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="upir.learning.learner.ArchitectureLearner.__repr__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__repr__</span><span class="p">()</span></code>

<a href="#upir.learning.learner.ArchitectureLearner.__repr__" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Developer-friendly representation.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>upir/learning/learner.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-533">533</a></span>
<span class="normal"><a href="#__codelineno-0-534">534</a></span>
<span class="normal"><a href="#__codelineno-0-535">535</a></span>
<span class="normal"><a href="#__codelineno-0-536">536</a></span>
<span class="normal"><a href="#__codelineno-0-537">537</a></span>
<span class="normal"><a href="#__codelineno-0-538">538</a></span>
<span class="normal"><a href="#__codelineno-0-539">539</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-533" name="__codelineno-0-533"></a><span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-534" name="__codelineno-0-534"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Developer-friendly representation.&quot;&quot;&quot;</span>
<a id="__codelineno-0-535" name="__codelineno-0-535"></a>    <span class="k">return</span> <span class="p">(</span>
<a id="__codelineno-0-536" name="__codelineno-0-536"></a>        <span class="sa">f</span><span class="s2">&quot;ArchitectureLearner(state_dim=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">state_dim</span><span class="si">}</span><span class="s2">, &quot;</span>
<a id="__codelineno-0-537" name="__codelineno-0-537"></a>        <span class="sa">f</span><span class="s2">&quot;action_dim=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">action_dim</span><span class="si">}</span><span class="s2">, &quot;</span>
<a id="__codelineno-0-538" name="__codelineno-0-538"></a>        <span class="sa">f</span><span class="s2">&quot;config=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="si">}</span><span class="s2">)&quot;</span>
<a id="__codelineno-0-539" name="__codelineno-0-539"></a>    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><hr />
<h2 id="usage-example">Usage Example<a class="headerlink" href="#usage-example" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">upir</span><span class="w"> </span><span class="kn">import</span> <span class="n">UPIR</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">upir.learning.learner</span><span class="w"> </span><span class="kn">import</span> <span class="n">ArchitectureLearner</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="c1"># Create learner</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="n">learner</span> <span class="o">=</span> <span class="n">ArchitectureLearner</span><span class="p">(</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    <span class="n">upir</span><span class="p">,</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>    <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.0003</span><span class="p">,</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>    <span class="n">gamma</span><span class="o">=</span><span class="mf">0.99</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="p">)</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="c1"># Simulate production metrics</span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="n">metrics</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>    <span class="s2">&quot;latency_p99&quot;</span><span class="p">:</span> <span class="mf">85.0</span><span class="p">,</span>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>    <span class="s2">&quot;monthly_cost&quot;</span><span class="p">:</span> <span class="mf">4500.0</span><span class="p">,</span>
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>    <span class="s2">&quot;throughput_qps&quot;</span><span class="p">:</span> <span class="mf">12000.0</span>
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="p">}</span>
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a><span class="c1"># Learn to optimize</span>
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a><span class="n">optimized_upir</span> <span class="o">=</span> <span class="n">learner</span><span class="o">.</span><span class="n">learn</span><span class="p">(</span>
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a>    <span class="n">metrics</span><span class="p">,</span>
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a>    <span class="n">episodes</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
<a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a>    <span class="n">steps_per_episode</span><span class="o">=</span><span class="mi">50</span>
<a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a><span class="p">)</span>
<a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a>
<a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a><span class="c1"># Compare</span>
<a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Original cost: $</span><span class="si">{</span><span class="n">upir</span><span class="o">.</span><span class="n">architecture</span><span class="o">.</span><span class="n">total_cost</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Optimized cost: $</span><span class="si">{</span><span class="n">optimized_upir</span><span class="o">.</span><span class="n">architecture</span><span class="o">.</span><span class="n">total_cost</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<hr />
<h2 id="see-also">See Also<a class="headerlink" href="#see-also" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="../ppo/">PPO</a> - PPO implementation</li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2025 Subhadip Mitra. Licensed under Apache 2.0.
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/bassrehab/upir" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": ["navigation.tabs", "navigation.sections", "navigation.expand", "navigation.top", "search.suggest", "search.highlight", "content.code.copy", "content.code.annotate"], "search": "../../../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
    
  </body>
</html>