{% extends "base.html" %}

{% block title %}UPIR Documentation - Universal Plan Intermediate Representation{% endblock %}

{% block content %}
<section class="docs-section">
    <div class="container">
        <div class="docs-header">
            <h1>UPIR Documentation</h1>
            <p class="lead">Complete guide to Universal Plan Intermediate Representation</p>
        </div>
        
        <div class="docs-grid">
            <!-- Sidebar Navigation -->
            <aside class="docs-sidebar">
                <nav class="docs-nav">
                    <h3>Getting Started</h3>
                    <ul>
                        <li><a href="#overview">Overview</a></li>
                        <li><a href="#installation">Installation</a></li>
                        <li><a href="#quickstart">Quick Start</a></li>
                    </ul>
                    
                    <h3>Core Concepts</h3>
                    <ul>
                        <li><a href="#specification">UPIR Specification</a></li>
                        <li><a href="#components">Components</a></li>
                        <li><a href="#patterns">Pattern Library</a></li>
                        <li><a href="#verification">Verification</a></li>
                    </ul>
                    
                    <h3>Advanced Features</h3>
                    <ul>
                        <li><a href="#synthesis">Program Synthesis</a></li>
                        <li><a href="#optimization">Parameter Optimization</a></li>
                        <li><a href="#codegen">Code Generation</a></li>
                        <li><a href="#compositional">Compositional Verification</a></li>
                    </ul>
                    
                    <h3>API Reference</h3>
                    <ul>
                        <li><a href="#python-api">Python API</a></li>
                        <li><a href="#rest-api">REST API</a></li>
                        <li><a href="#cli">CLI Tool</a></li>
                    </ul>
                </nav>
            </aside>
            
            <!-- Main Content -->
            <main class="docs-content">
                <section id="overview">
                    <h2>Overview</h2>
                    <p>UPIR (Universal Plan Intermediate Representation) is a powerful framework for designing, verifying, and generating distributed systems. It provides a formal specification language combined with automated synthesis and verification capabilities.</p>
                    
                    <div class="feature-highlights">
                        <div class="highlight-card">
                            <h4>ðŸš€ 274Ã— Faster</h4>
                            <p>Than traditional synthesis approaches</p>
                        </div>
                        <div class="highlight-card">
                            <h4>âš¡ 1.71ms</h4>
                            <p>Average code generation time</p>
                        </div>
                        <div class="highlight-card">
                            <h4>âœ“ 89.9%</h4>
                            <p>Pattern reuse across systems</p>
                        </div>
                    </div>
                </section>
                
                <section id="installation">
                    <h2>Installation</h2>
                    <div class="code-block">
                        <div class="code-header">
                            <span>Terminal</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre><code># Install UPIR via pip
pip install upir

# Or install from source
git clone http://go/upir:code
cd upir
pip install -e .</code></pre>
                    </div>
                    
                    <h3>Requirements</h3>
                    <ul>
                        <li>Python 3.8 or higher</li>
                        <li>Z3 SMT Solver (installed automatically)</li>
                        <li>Optional: PyTorch for PPO-based optimization</li>
                    </ul>
                </section>
                
                <section id="quickstart">
                    <h2>Quick Start</h2>
                    <p>Create your first UPIR specification:</p>
                    
                    <div class="code-block">
                        <div class="code-header">
                            <span>example.upir</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre><code>system SimpleQueue {
  components {
    queue: QueueWorker {
      pattern: "queue_worker"
      requirements {
        batch_size: 32
        workers: 4
      }
    }
  }
  
  properties {
    safety no_data_loss {
      formula: "G(enqueued => F(processed))"
    }
  }
}</code></pre>
                    </div>
                    
                    <p>Generate code from the specification:</p>
                    
                    <div class="code-block">
                        <div class="code-header">
                            <span>Python</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre><code>from upir import UPIR, CodeGenerator

# Load specification
spec = UPIR.load("example.upir")

# Verify correctness
if spec.verify():
    print("âœ“ Specification is valid")
    
# Generate Python code
generator = CodeGenerator()
code = generator.generate(spec, language="python")
print(code)</code></pre>
                    </div>
                </section>
                
                <section id="specification">
                    <h2>UPIR Specification Language</h2>
                    <p>UPIR uses a declarative specification language to describe distributed systems:</p>
                    
                    <h3>System Definition</h3>
                    <div class="code-block">
                        <div class="code-header">
                            <span>UPIR Syntax</span>
                        </div>
                        <pre><code>system SystemName {
  components { ... }
  connections { ... }
  properties { ... }
  constraints { ... }
}</code></pre>
                    </div>
                    
                    <h3>Components</h3>
                    <p>Components are the building blocks of your system:</p>
                    <ul>
                        <li><strong>pattern</strong>: Reusable component template</li>
                        <li><strong>requirements</strong>: Configuration parameters</li>
                        <li><strong>properties</strong>: Invariants and guarantees</li>
                    </ul>
                    
                    <h3>Properties</h3>
                    <p>Define safety and liveness properties using temporal logic:</p>
                    <ul>
                        <li><code>G</code> - Globally (always)</li>
                        <li><code>F</code> - Eventually</li>
                        <li><code>X</code> - Next</li>
                        <li><code>U</code> - Until</li>
                    </ul>
                </section>
                
                <section id="patterns">
                    <h2>Pattern Library</h2>
                    <p>UPIR includes a rich library of reusable patterns:</p>
                    
                    <div class="pattern-grid">
                        <div class="pattern-card">
                            <h4>Queue Worker</h4>
                            <p>Batch processing with configurable workers</p>
                            <code>pattern: "queue_worker"</code>
                        </div>
                        <div class="pattern-card">
                            <h4>Rate Limiter</h4>
                            <p>Token bucket rate limiting</p>
                            <code>pattern: "rate_limiter"</code>
                        </div>
                        <div class="pattern-card">
                            <h4>Circuit Breaker</h4>
                            <p>Fault tolerance pattern</p>
                            <code>pattern: "circuit_breaker"</code>
                        </div>
                        <div class="pattern-card">
                            <h4>Load Balancer</h4>
                            <p>Request distribution</p>
                            <code>pattern: "load_balancer"</code>
                        </div>
                        <div class="pattern-card">
                            <h4>Cache Layer</h4>
                            <p>LRU caching with TTL</p>
                            <code>pattern: "cache"</code>
                        </div>
                        <div class="pattern-card">
                            <h4>Event Stream</h4>
                            <p>Pub/sub messaging</p>
                            <code>pattern: "event_stream"</code>
                        </div>
                    </div>
                </section>
                
                <section id="synthesis">
                    <h2>Program Synthesis</h2>
                    <p>UPIR uses bounded synthesis with CEGIS to automatically generate implementations:</p>
                    
                    <div class="code-block">
                        <div class="code-header">
                            <span>Python</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre><code>from upir import Synthesizer

# Define partial specification
spec = """
system AutoGenerated {
  components {
    processor: Unknown {
      requirements {
        throughput: ">= 5000"
        latency: "<= 100ms"
      }
    }
  }
}
"""

# Synthesize implementation
synthesizer = Synthesizer()
implementation = synthesizer.synthesize(spec)
print(f"Synthesized: {implementation.pattern}")
# Output: Synthesized: queue_worker with batch_size=94, workers=14</code></pre>
                    </div>
                </section>
                
                <section id="optimization">
                    <h2>Parameter Optimization</h2>
                    <p>Use Z3 SMT solver for optimal parameter selection:</p>
                    
                    <div class="code-block">
                        <div class="code-header">
                            <span>Python</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre><code>from upir import ParameterOptimizer

optimizer = ParameterOptimizer()
params = optimizer.optimize(
    constraints=[
        "batch_size * workers * 10 >= throughput",
        "batch_size <= 128",
        "workers <= 16",
        "throughput >= 5000"
    ],
    objective="minimize(batch_size * workers)"
)

print(f"Optimal: batch_size={params['batch_size']}, workers={params['workers']}")
# Output: Optimal: batch_size=94, workers=14</code></pre>
                    </div>
                </section>
                
                <section id="python-api">
                    <h2>Python API Reference</h2>
                    
                    <h3>Core Classes</h3>
                    <div class="api-docs">
                        <div class="api-class">
                            <h4>UPIR</h4>
                            <p>Main class for loading and manipulating UPIR specifications</p>
                            <div class="api-methods">
                                <code>load(path: str) -> UPIR</code>
                                <code>verify() -> bool</code>
                                <code>to_dict() -> dict</code>
                            </div>
                        </div>
                        
                        <div class="api-class">
                            <h4>CodeGenerator</h4>
                            <p>Generate code from UPIR specifications</p>
                            <div class="api-methods">
                                <code>generate(spec: UPIR, language: str) -> str</code>
                                <code>get_supported_languages() -> List[str]</code>
                            </div>
                        </div>
                        
                        <div class="api-class">
                            <h4>Verifier</h4>
                            <p>Formal verification of properties</p>
                            <div class="api-methods">
                                <code>verify_safety(spec: UPIR) -> VerificationResult</code>
                                <code>verify_liveness(spec: UPIR) -> VerificationResult</code>
                            </div>
                        </div>
                    </div>
                </section>
                
                <section id="rest-api">
                    <h2>REST API</h2>
                    
                    <h3>Generate Code</h3>
                    <div class="api-endpoint">
                        <div class="endpoint-header">
                            <span class="method">POST</span>
                            <code>/api/generate</code>
                        </div>
                        <div class="endpoint-body">
                            <p>Generate code from a template</p>
                            <pre><code>{
  "template": "queue_worker",
  "language": "python"
}</code></pre>
                        </div>
                    </div>
                    
                    <h3>Verify Specification</h3>
                    <div class="api-endpoint">
                        <div class="endpoint-header">
                            <span class="method">POST</span>
                            <code>/api/verify</code>
                        </div>
                        <div class="endpoint-body">
                            <p>Verify a UPIR specification</p>
                            <pre><code>{
  "specification": "system Test { ... }"
}</code></pre>
                        </div>
                    </div>
                    
                    <h3>Synthesize Parameters</h3>
                    <div class="api-endpoint">
                        <div class="endpoint-header">
                            <span class="method">POST</span>
                            <code>/api/synthesize</code>
                        </div>
                        <div class="endpoint-body">
                            <p>Synthesize optimal parameters</p>
                            <pre><code>{
  "constraints": "throughput >= 5000\nlatency <= 100"
}</code></pre>
                        </div>
                    </div>
                </section>
                
                <section id="cli">
                    <h2>CLI Tool</h2>
                    <div class="code-block">
                        <div class="code-header">
                            <span>Terminal</span>
                        </div>
                        <pre><code># Verify a specification
upir verify system.upir

# Generate code
upir generate system.upir --language python --output system.py

# Optimize parameters
upir optimize system.upir --constraints constraints.txt

# Interactive mode
upir repl</code></pre>
                    </div>
                </section>
            </main>
        </div>
    </div>
</section>

<style>
.docs-section {
    padding: 2rem 0;
    min-height: calc(100vh - 200px);
}

.docs-header {
    text-align: center;
    padding: 2rem 0;
    margin-bottom: 3rem;
}

.docs-header h1 {
    font-size: 2.5rem;
    margin-bottom: 1rem;
}

.docs-grid {
    display: grid;
    grid-template-columns: 250px 1fr;
    gap: 3rem;
    align-items: start;
}

.docs-sidebar {
    position: sticky;
    top: 80px;
    max-height: calc(100vh - 100px);
    overflow-y: auto;
}

.docs-nav h3 {
    font-size: 0.875rem;
    text-transform: uppercase;
    color: var(--gray);
    margin: 1.5rem 0 0.5rem;
    font-weight: 600;
}

.docs-nav ul {
    list-style: none;
    padding: 0;
}

.docs-nav li {
    margin: 0.25rem 0;
}

.docs-nav a {
    color: var(--dark);
    text-decoration: none;
    font-size: 0.95rem;
    display: block;
    padding: 0.25rem 0;
    transition: color 0.3s;
}

.docs-nav a:hover {
    color: var(--primary-color);
}

.docs-content section {
    margin-bottom: 4rem;
    scroll-margin-top: 100px;
}

.docs-content h2 {
    font-size: 2rem;
    margin-bottom: 1.5rem;
    color: var(--dark);
}

.docs-content h3 {
    font-size: 1.5rem;
    margin: 2rem 0 1rem;
}

.feature-highlights {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1.5rem;
    margin: 2rem 0;
}

.highlight-card {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 1.5rem;
    border-radius: 8px;
    text-align: center;
}

.highlight-card h4 {
    font-size: 1.5rem;
    margin-bottom: 0.5rem;
}

.code-block {
    margin: 1.5rem 0;
    border: 1px solid var(--border);
    border-radius: 8px;
    overflow: hidden;
}

.code-header {
    background: var(--light-gray);
    padding: 0.75rem 1rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 0.875rem;
    font-weight: 500;
}

.copy-btn {
    background: white;
    border: 1px solid var(--border);
    padding: 0.25rem 0.75rem;
    border-radius: 4px;
    cursor: pointer;
    font-size: 0.875rem;
}

.copy-btn:hover {
    background: var(--light-gray);
}

.code-block pre {
    margin: 0;
    padding: 1rem;
    background: #1e1e1e;
    color: #d4d4d4;
    overflow-x: auto;
}

.pattern-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1.5rem;
    margin: 2rem 0;
}

.pattern-card {
    background: white;
    border: 1px solid var(--border);
    padding: 1.5rem;
    border-radius: 8px;
    transition: transform 0.3s, box-shadow 0.3s;
}

.pattern-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.pattern-card h4 {
    margin-bottom: 0.5rem;
    color: var(--primary-color);
}

.pattern-card code {
    display: block;
    margin-top: 1rem;
    padding: 0.5rem;
    background: var(--light-gray);
    border-radius: 4px;
    font-size: 0.875rem;
}

.api-docs {
    margin: 2rem 0;
}

.api-class {
    background: white;
    border: 1px solid var(--border);
    padding: 1.5rem;
    border-radius: 8px;
    margin-bottom: 1.5rem;
}

.api-class h4 {
    color: var(--primary-color);
    margin-bottom: 0.5rem;
}

.api-methods {
    margin-top: 1rem;
}

.api-methods code {
    display: block;
    padding: 0.5rem;
    background: var(--light-gray);
    margin: 0.5rem 0;
    border-radius: 4px;
    font-size: 0.875rem;
}

.api-endpoint {
    border: 1px solid var(--border);
    border-radius: 8px;
    margin: 1.5rem 0;
    overflow: hidden;
}

.endpoint-header {
    background: var(--light-gray);
    padding: 1rem;
    display: flex;
    align-items: center;
    gap: 1rem;
}

.endpoint-header .method {
    background: var(--primary-color);
    color: white;
    padding: 0.25rem 0.75rem;
    border-radius: 4px;
    font-weight: 600;
    font-size: 0.875rem;
}

.endpoint-body {
    padding: 1rem;
}

.endpoint-body pre {
    background: #1e1e1e;
    color: #d4d4d4;
    padding: 1rem;
    border-radius: 4px;
    margin-top: 1rem;
}

@media (max-width: 768px) {
    .docs-grid {
        grid-template-columns: 1fr;
    }
    
    .docs-sidebar {
        position: static;
        max-height: none;
        margin-bottom: 2rem;
        border-bottom: 1px solid var(--border);
        padding-bottom: 2rem;
    }
    
    .feature-highlights,
    .pattern-grid {
        grid-template-columns: 1fr;
    }
}
</style>

<script>
function copyCode(button) {
    const codeBlock = button.closest('.code-block');
    const code = codeBlock.querySelector('code').textContent;
    
    navigator.clipboard.writeText(code).then(() => {
        const originalText = button.textContent;
        button.textContent = 'Copied!';
        setTimeout(() => {
            button.textContent = originalText;
        }, 2000);
    });
}

// Smooth scroll to sections
document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
            target.scrollIntoView({
                behavior: 'smooth',
                block: 'start'
            });
        }
    });
});
</script>
{% endblock %}